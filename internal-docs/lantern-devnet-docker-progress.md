# Lantern Devnet Docker Integration Progress

## Current Status

- Added a dedicated `lantern` service to `local-pq-devnet/docker-compose.yml` that builds the repository image, mounts the shared `config` / `genesis` artifacts, and participates on the existing `ream-network` bridge.
- Extended `local-pq-devnet/setup-genesis.sh` to generate seven node keypairs (including `lantern_6`), run non-interactively without a TTY, and emit validator mappings in the simplified format produced by the current genesis tooling.
- Hardened the Lantern Docker build so it bootstraps vendored dependencies in an environment without `.git` metadata, installs the libtommath shared library, and creates SONAME symlinks for runtime resolution of `libtomcrypt.so.1`.
- Relaxed bootnode registration and validator-registry parsing so Lantern can tolerate the YAML structures emitted by `setup-genesis.sh` while still logging failures for missing ENR data.
- Verified `ctest --test-dir build --parallel 8 -V` passes locally before launching the Docker stack, and confirmed `lantern-node6` reaches the QUIC handshake with peer logs visible via `docker logs`.
- Normalized ENR peer ingestion to accept `quic` port fields emitted by devnet genesis artifacts; warnings are gone in unit coverage (`lantern_libp2p_test` exercises the quic-only ENRs).
- Fixed QUIC TLS interoperability so Lantern’s certificates now validate against the other clients; `docker compose up --build -d` shows clean logs without the previous `invalid peer certificate` shutdowns.
- Repro commands used during the latest interop test run:
  - `cd ../local-pq-devnet && docker compose up --build -d`
  - `docker compose ps`
  - `docker compose logs lantern --tail=200`
  - `docker compose logs node0 --tail=200`
  - `docker compose down`

## Known Issues

- Genesis state decoding still fails with the placeholder artifacts generated by the local devnet script (`failed to decode genesis state; head snapshot disabled`). This prevents Lantern from restoring its head snapshot on boot.

## Next Steps

1. Investigate the genesis-state decode failure surfaced by both the unit harness and the Docker stack so Lantern can restore its head snapshot on boot. Capture failing `lantern_ssz_decode_state` inputs, compare against the spec fixtures in `leanSpec`, and add regression tests once the parser accepts the canonical payload.
2. Align the genesis validator registry format across tooling so Lantern receives full pubkey/withdrawal credentials—replace the zeroed placeholders from fallback parsing with the data emitted by `setup-genesis.sh`, and document the contract so future tooling stays consistent.
3. Once genesis state decoding succeeds, validate head snapshot restoration and update `lantern-devnet0-checklist.md` accordingly.
